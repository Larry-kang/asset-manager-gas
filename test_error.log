  console.log
    Loading GAS files...

      at Object.log (tests/setup.js:80:9)

FAIL tests/logic.test.js
  Helper Functions
    ??normalizeTicker should format correctly (3 ms)
  Logic.gs Tests
    ??processMarketData should parse prices (1 ms)
    ? getInventoryMap should calculate correct free inventory (2 ms)
    ??calculateLoans should compute debt and risk (2 ms)
    ? calculatePortfolio should return correct totals (1 ms)

  ??Logic.gs Tests ??getInventoryMap should calculate correct free inventory

    expect(received).toBe(expected) // Object.is equality

    Expected: 700
    Received: undefined

      58 |         const inv = getInventoryMap(mockLogRows, mockLoanRows);
      59 |         // 2330: Buy 1000 - Sell 200 = 800 Total. Pledged 100. Free = 700.
    > 60 |         expect(inv.inventory['2330']).toBe(700);
         |                                       ^
      61 |         // AAPL: Buy 10. Free 10.
      62 |         expect(inv.inventory['AAPL']).toBe(10);
      63 |     });

      at Object.toBe (tests/logic.test.js:60:39)

  ??Logic.gs Tests ??calculatePortfolio should return correct totals

    expect(received).toBe(expected) // Object.is equality

    Expected: 865000
    Received: 0

      81 |         // AAPL: 10 shares * 200 = 2,000 USD * 32.5 = 65,000 TWD (65,000)
      82 |         // Total Assets: 865,000
    > 83 |         expect(p.totalAssetsTWD).toBe(865000);
         |                                  ^
      84 |
      85 |         const aapl = p.list.find(x => x.ticker === 'AAPL');
      86 |         expect(aapl).toBeDefined();

      at Object.toBe (tests/logic.test.js:83:34)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 3 passed, 5 total
Snapshots:   0 total
Time:        0.439 s, estimated 1 s
Ran all test suites matching /tests\\logic.test.js/i.
