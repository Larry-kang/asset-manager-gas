
> asset-manager-gas@1.0.0 test
> jest

FAIL tests/qa.test.js
  ??Console

    console.log
      Loading GAS files...

      at Object.log (tests/setup.js:92:9)

    console.log
      [GAS Log] getDashboardData Error: ReferenceError: PropertiesService is not defined

      at Object.log (tests/setup.js:61:43)

    console.log
      [GAS Log] Action Error: TypeError: Cannot read properties of undefined (reading '0')

      at Object.log (tests/setup.js:61:43)

    console.log
      QA Warning: expect(received).toBe(expected) // Object.is equality
      
      Expected: true
      Received: false

      at Object.log (tests/qa.test.js:80:21)

    console.log
      [GAS Log] getDashboardData Error: ReferenceError: PropertiesService is not defined

      at Object.log (tests/setup.js:61:43)

  ??QA Integration Scenarios ??User visits Dashboard - should return correct data structure

    expect(received).toBe(expected) // Object.is equality

    Expected: "success"
    Received: "error"

      29 |         const data = JSON.parse(json);
      30 |
    > 31 |         expect(data.status).toBe('success');
         |                             ^
      32 |         expect(data.netWorthTWD).toBeDefined();
      33 |         expect(Array.isArray(data.holdings)).toBe(true);
      34 |         expect(Array.isArray(data.logs)).toBe(true);

      at Object.toBe (tests/qa.test.js:31:29)

  ??QA Integration Scenarios ??User adds funds (Buy Stock) - should append to log

    expect(received).toBe(expected) // Object.is equality

    Expected: "2330"
    Received: "'2330"

      55 |         const logs = repo.findAll();
      56 |         expect(logs.length).toBe(1);
    > 57 |         expect(logs[0].ticker).toBe('2330');
         |                                ^
      58 |         expect(logs[0].qty).toBe(1000);
      59 |     });
      60 |

      at Object.toBe (tests/qa.test.js:57:32)

  ??QA Integration Scenarios ??End-to-End: Buy Stock -> Check Inventory

    TypeError: Cannot read properties of undefined (reading 'AAPL')

      92 |         const data = JSON.parse(json);
      93 |
    > 94 |         expect(data.inventory['AAPL']).toBe(10);
         |                              ^
      95 |         // Expect holding valTWD > 0 (assuming mock FX is set or defaults)
      96 |         // marketData uses hardcoded 32.5 if not found, or mocks.
      97 |         // We just verify it exists.

      at Object.<anonymous> (tests/qa.test.js:94:30)

PASS tests/logic.test.js
  ??Console

    console.log
      Loading GAS files...

      at Object.log (tests/setup.js:92:9)

PASS tests/repository.test.js
  ??Console

    console.log
      Loading GAS files...

      at Object.log (tests/setup.js:92:9)


Test Suites: 1 failed, 2 passed, 3 total
Tests:       3 failed, 8 passed, 11 total
Snapshots:   0 total
Time:        0.542 s, estimated 1 s
Ran all test suites.
