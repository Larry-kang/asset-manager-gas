FAIL tests/logic.test.js
  Helper Functions
    ? normalizeTicker should format correctly (5 ms)
  Logic.gs Tests
    ? processMarketData should parse prices
    ? getInventoryMap should calculate total inventory
    ? calculateLoans should compute debt and risk
    ? calculatePortfolio should return correct totals

  ??Helper Functions ??normalizeTicker should format correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: "0050"
    Received: "50"

      15 |         expect(normalizeTicker('  btc  ')).toBe('BTC');
      16 |         expect(normalizeTicker('0050')).toBe('0050');
    > 17 |         expect(normalizeTicker('50')).toBe('0050'); // Assuming strict logic kept this
         |                                       ^
      18 |     });
      19 | });
      20 |

      at Object.toBe (tests/logic.test.js:17:39)

  ??Logic.gs Tests ??processMarketData should parse prices

    expect(received).toBe(expected) // Object.is equality

    Expected: 1000
    Received: undefined

      52 |         const m = processMarketData(mockMarketRows);
      53 |         expect(m.fx).toBe(32.5);
    > 54 |         expect(m.prices['2330']).toBe(1000);
         |                                  ^
      55 |         expect(m.prices['AAPL']).toBe(200);
      56 |     });
      57 |

      at Object.toBe (tests/logic.test.js:54:34)

  ??Logic.gs Tests ??getInventoryMap should calculate total inventory

    expect(received).toBe(expected) // Object.is equality

    Expected: 800
    Received: 0

      62 |         // getInventoryMap returns { Ticker: { qty, cost, currency } }
      63 |         expect(inv['2330']).toBeDefined();
    > 64 |         expect(inv['2330'].qty).toBe(800);
         |                                 ^
      65 |
      66 |         // AAPL: Buy 10.
      67 |         expect(inv['AAPL']).toBeDefined();

      at Object.toBe (tests/logic.test.js:64:33)

  ??Logic.gs Tests ??calculateLoans should compute debt and risk

    expect(received).toBeGreaterThan(expected)

    Expected: > 10000
    Received:   10000

      74 |
      75 |         expect(res.pledged['2330']).toBe(100);
    > 76 |         expect(res.totalDebtTWD).toBeGreaterThan(10000); // Principal + Interest
         |                                  ^
      77 |         expect(res.risks.length).toBe(1);
      78 |         expect(res.risks[0].status).toBe('Safe');
      79 |     });

      at Object.toBeGreaterThan (tests/logic.test.js:76:34)

  ??Logic.gs Tests ??calculatePortfolio should return correct totals

    expect(received).toBe(expected) // Object.is equality

    Expected: 865000
    Received: 0

      87 |         // AAPL: 10 shares * 200 = 2,000 USD * 32.5 = 65,000 TWD
      88 |         // Total Assets: 865,000
    > 89 |         expect(p.totalAssetsTWD).toBe(865000);
         |                                  ^
      90 |
      91 |         const aapl = p.list.find(x => x.ticker === 'AAPL');
      92 |         expect(aapl).toBeDefined();

      at Object.toBe (tests/logic.test.js:89:34)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 5 total
Snapshots:   0 total
Time:        0.411 s, estimated 1 s
Ran all test suites matching /tests\\logic.test.js/i.
