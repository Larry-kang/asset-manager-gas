
> asset-manager-gas@1.0.0 test
> jest

FAIL tests/qa.test.js
  ??Console

    console.log
      Loading GAS files...

      at Object.log (tests/setup.js:86:9)

    console.log
      [GAS Log] getDashboardData Error: TypeError: sM.getRange(...).setNumberFormat is not a function

      at Object.log (tests/setup.js:55:43)

    console.log
      [GAS Log] Action Error: TypeError: Cannot read properties of undefined (reading '0')

      at Object.log (tests/setup.js:55:43)

    console.log
      QA Warning: expect(received).toBe(expected) // Object.is equality
      
      Expected: true
      Received: false

      at Object.log (tests/qa.test.js:79:21)

    console.log
      [GAS Log] getDashboardData Error: TypeError: sM.getRange(...).setNumberFormat is not a function

      at Object.log (tests/setup.js:55:43)

  ??QA Integration Scenarios ??User visits Dashboard - should return correct data structure

    expect(received).toBe(expected) // Object.is equality

    Expected: "success"
    Received: "error"

      29 |         const data = JSON.parse(json);
      30 |
    > 31 |         expect(data.status).toBe('success');
         |                             ^
      32 |         expect(data.netWorthTWD).toBeDefined();
      33 |         expect(Array.isArray(data.holdings)).toBe(true);
      34 |         expect(Array.isArray(data.logs)).toBe(true);

      at Object.toBe (tests/qa.test.js:31:29)

  ??QA Integration Scenarios ??User adds funds (Buy Stock) - should append to log

    expect(received).toBe(expected) // Object.is equality

    Expected: "鈭斗?蝝?憓???
    Received: {"message": "鈭斗?蝝?憓???, "success": true}

      48 |
      49 |         const result = addTx(tx);
    > 50 |         expect(result).toBe('\u4EA4\u6613\u7D00\u9304\u65B0\u589E\u6210\u529F'); // 鈭斗?蝝?憓???[39m
         |                        ^
      51 |
      52 |         // Verify Data Persistence
      53 |         const repo = new LogRepository();

      at Object.toBe (tests/qa.test.js:50:24)

  ??QA Integration Scenarios ??End-to-End: Buy Stock -> Check Inventory

    TypeError: Cannot read properties of undefined (reading 'AAPL')

      91 |         const data = JSON.parse(json);
      92 |
    > 93 |         expect(data.inventory['AAPL']).toBe(10);
         |                              ^
      94 |         // Expect holding valTWD > 0 (assuming mock FX is set or defaults)
      95 |         // marketData uses hardcoded 32.5 if not found, or mocks.
      96 |         // We just verify it exists.

      at Object.<anonymous> (tests/qa.test.js:93:30)

PASS tests/logic.test.js
  ??Console

    console.log
      Loading GAS files...

      at Object.log (tests/setup.js:86:9)

PASS tests/repository.test.js
  ??Console

    console.log
      Loading GAS files...

      at Object.log (tests/setup.js:86:9)


Test Suites: 1 failed, 2 passed, 3 total
Tests:       3 failed, 8 passed, 11 total
Snapshots:   0 total
Time:        0.542 s, estimated 1 s
Ran all test suites.
