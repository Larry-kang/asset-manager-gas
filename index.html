<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <?!= include('css'); ?>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

  <!-- Top Navigation Bar (Glass) -->
  <div class="nav-bar">
    <div id="navBack" class="nav-back hidden"><i class="fa-solid fa-chevron-left"></i> 返回</div>
    <div id="navTitle">資產管家</div>
    <div id="navAction" class="nav-action" onclick="load(true)"><i class="fa-solid fa-rotate-right"></i></div>
  </div>

  <!-- Main View Container -->
  <div class="view-container">

    <!-- DASHBOARD VIEW -->
    <div id="dash" class="view active">
      <!-- Overview Card -->
      <h1>概覽</h1>
      <div class="chart-scroll">
        <div class="chart-card">
          <h3>淨資產 (TWD)</h3>
          <div class="text-val" style="font-size:32px" id="netWorth">...</div>
        </div>
        <div class="chart-card">
          <h3>總資產 / 總負債</h3>
          <div class="grid-2">
            <div>
              <div class="text-sub">Asset</div>
              <div class="text-val" id="totalAssets">...</div>
            </div>
            <div>
              <div class="text-sub">Debt</div>
              <div class="text-val" id="totalDebt">...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart -->
      <h2>資產配置</h2>
      <div style="background:var(--bg-card);border-radius:12px;padding:20px;margin-left:16px;margin-right:16px">
        <canvas id="assetChart" height="200"></canvas>
      </div>
    </div>

    <!-- HOLDINGS VIEW -->
    <div id="holdings" class="view">
      <h1>持倉</h1>
      <div id="holdingsList">
        <!-- Injected by JS -->
      </div>
    </div>

    <!-- LOAN VIEW -->
    <div id="loan" class="view">
      <h1>借貸</h1>

      <div id="riskList" style="margin-bottom:20px">
        <!-- Risk Cards (Horizontal Scroll) -->
      </div>

      <div id="loanList">
        <!-- Contract Groups -->
      </div>
    </div>

    <!-- SETTINGS VIEW -->
    <div id="settings" class="view">
      <h1>設定</h1>
      <div class="ios-list">
        <div class="ios-row" onclick="toggleTheme()">
          <div class="flex-cnt"><i class="fa-solid fa-moon"></i> 深色模式</div>
          <div id="themeBtn" class="text-sub">Switch</div>
        </div>
      </div>

      <h3>資料庫</h3>
      <div class="ios-list">
        <div class="ios-row">
          <div class="flex-cnt"><i class="fa-solid fa-database"></i> 執行系統檢查</div>
          <button class="ios-btn-outline" onclick="google.script.run.runSystemCheck()">Run</button>
        </div>
      </div>

      <p style="text-align:center;color:var(--text-secondary);font-size:12px;margin-top:20px">Asset Manager v3.2 (iOS
        Style)</p>
    </div>

  </div>

  <!-- Bottom Tab Bar (Glass) -->
  <div class="tab-bar">
    <div class="tab-item active" onclick="go('dash')">
      <i class="tab-icon fa-solid fa-chart-pie"></i>
      <span>概覽</span>
    </div>
    <div class="tab-item" onclick="go('holdings')">
      <i class="tab-icon fa-solid fa-wallet"></i>
      <span>持倉</span>
    </div>
    <div class="tab-item" onclick="go('loan')">
      <i class="tab-icon fa-solid fa-hand-holding-dollar"></i>
      <span>借貸</span>
    </div>
    <div class="tab-item" onclick="go('settings')">
      <i class="tab-icon fa-solid fa-gear"></i>
      <span>設定</span>
    </div>
  </div>

  <!-- Bottom Sheets -->

  <!-- Transaction Sheet -->
  <div id="sheetTx" class="sheet-overlay">
    <div class="sheet-content">
      <div class="sheet-handle"></div>
      <h2>新增交易</h2>

      <label>日期</label>
      <input type="date" id="tDate">

      <div class="grid-2">
        <div>
          <label>類別</label>
          <select id="tCat">
            <option>股票</option>
            <option>加密貨幣</option>
            <option>現金</option>
          </select>
        </div>
        <div>
          <label>動作</label>
          <select id="tType">
            <option>買入</option>
            <option>賣出</option>
            <option>配息</option>
          </select>
        </div>
      </div>

      <label>標的代號</label>
      <input type="text" id="tTicker" placeholder="e.g. 2330" list="tickerList">
      <datalist id="tickerList"></datalist>

      <div class="grid-2">
        <div><label>數量</label><input type="number" id="tQty" placeholder="0"></div>
        <div><label>單價</label><input type="number" id="tPrice" placeholder="0"></div>
      </div>

      <label>幣別</label>
      <select id="tCurrency">
        <option>TWD</option>
        <option>USD</option>
      </select>

      <button id="btnTx" class="ios-btn" onclick="subTx()">送出交易</button>
      <button class="ios-btn ios-btn-destructive" style="margin-top:10px;background:none"
        onclick="closeSheet('sheetTx')">取消</button>
    </div>
  </div>

  <!-- Loading / Msg Modal (Special Case) -->
  <div id="msgModal" class="sheet-overlay" style="z-index:3000">
    <div class="sheet-content" style="padding-bottom:40px">
      <div class="sheet-handle"></div>
      <div style="text-align:center">
        <div id="msgIcon" style="font-size:40px;margin-bottom:10px">??</div>
        <h2 id="msgTitle">通知</h2>
        <p id="msgBody" class="text-sub">Message Body</p>
        <button class="ios-btn" onclick="closeSheet('msgModal')">我知道了</button>
      </div>
    </div>
  </div>

  <!-- Dev Console -->
  <div id="devConsole" style="display:none"></div>
  <button id="consoleToggle" onclick="toggleConsole()" style="display:none">Log</button>

  <!-- Scripts -->
  <?!= include('js'); ?>

</body>

</html>